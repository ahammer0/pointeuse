{% block periodes %}
<div id="periodes"
    hx-swap-oob="true">

  {% for pds in periodesbd %} 
    <hr/>

    {% if pds|length >0 %}
      <p>{{datetime.fromtimestamp(pds[0].timestamp_in).strftime('%A %d') }}</p>
    {% endif %}

    {% for periode in pds %}
    {% endfor %}
        <div class="period_bar" >
          <div class="bars">
            {% for per in pds %}
            <div 
              id="periode_{{per.timestamp_in}}"
              class="el" 
              style="
              width:{{(per.getTodaySeconds(per.timestamp_out)-per.getTodaySeconds(per.timestamp_in))*100/(24*60*60)}}%;
              left:{{per.getTodaySeconds(per.timestamp_in)/(24*60*60)*100}}%;
              "
              x-data="{
                open: false,
                resizeMenu() {
                  this.$nextTick(()=>{
                    requestAnimationFrame(()=>{
                      if(!this.$refs.menu) return;
                      let menuRight= this.$refs.menu.getBoundingClientRect().right
                      console.log(menuRight)
                      if(menuRight>window.innerWidth){
                        this.$refs.menu.style.right = '0'
                        this.$refs.menu.style.left = 'auto'
                      }
                      else{
                        this.$refs.menu.style.left = '0'
                        this.$refs.menu.style.right = 'auto'
                      }
                    })
                  })
                },
              }"
              @mouseenter="open=true"
              @mouseleave="open=false"
              x-effect=" if(open)resizeMenu() "

            >
              <div 
                class="menu" 
                x-show="open"
                x-ref="menu"
                x-cloak
              >
                
                <div class="buttons">
                  <button 
                    id="delete"
                    hx-delete="/periode?id={{per.id}}"
                    hx-target="#periode_{{per.timestamp_in}}"
                    hx-swap="outerHTML"
                    hx-confirm="Voulez-vous vraiment supprimer cette periode ?"
                  >Del</button>
                  <a href="/editperiode?id={{per.id}}">Edit</a>
                </div>
              <div class="data" >
                  id:{{per.id}} - {{per.getStartTimeStr()}} - {{per.getEndTimeStr()}} : {{per.getDuration()}}
                </div>

              </div>
            </div>
            {% endfor %}
          </div>
          <div class="labels">
            <div class="label" style=" left:0%; ">0h</div>
            <div class="label" style=" left:33.33%; ">8h</div>
            <div class="label" style=" left:50%; ">12h</div>
            <div class="label" style=" left:75%; ">18h</div>
            <div class="label" style=" right:0%; ">24h</div>
          </div>
        </div>
  {% endfor %}



</div>
{% endblock %}
